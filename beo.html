<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Generar Beo - Restaurante El Rodeo</title>
<link rel="stylesheet" href="estilos.css">
<style>
/* === PALETA DE COLORES EL RODEO === */
:root {
  --rojo: #b11226;
  --dorado: #ffd700;
  --gris-fondo: #2a2a40;
  --gris-tabla: #35354a;
  --gris-input: #3a3a5a;
  --blanco: #fff;
  --verde: #28a745;
  --naranja: #ff9800;
}

/* === ESTILOS GENERALES === */
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  margin: 20px;
  background: var(--gris-fondo);
  color: var(--blanco);
  line-height: 1.5;
}

/* === ENCABEZADO === */
header {
  text-align: center;
  margin-bottom: 20px;
}

header h1 {
  color: var(--dorado);
  font-size: 2em;
}

/* === MEN√ö DE BOTONES === */
.menu-botones {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 20px;
}

.menu-botones button {
  background: var(--dorado);
  color: var(--gris-fondo);
  border: none;
  padding: 10px 18px;
  font-weight: bold;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1em;
  transition: all 0.3s;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.menu-botones button:hover {
  background: #e6c200;
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 12px rgba(0,0,0,0.4);
}

/* === CONTENEDOR PRINCIPAL === */
.container {
  width: 95%;
  max-width: 1200px;
  background: var(--gris-tabla);
  margin: 0 auto 30px auto;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

/* === T√çTULOS === */
h2 {
  text-align: center;
  color: var(--dorado);
  margin-bottom: 20px;
}

/* === FORMULARIO === */
form {
  width: 100%;
}

label {
  font-weight: 600;
  display: block;
  margin-top: 6px;
}

input, select, textarea {
  width: 100%;
  padding: 8px 10px;
  margin-top: 4px;
  border: 1.5px solid #555;
  border-radius: 6px;
  font-size: 0.95em;
  background: var(--gris-input);
  color: var(--blanco);
}

input::placeholder, textarea::placeholder {
  color: #ccc;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--dorado);
  outline: none;
  box-shadow: 0 0 6px rgba(255,215,0,0.3);
}

/* === FILAS Y COLUMNAS === */
.row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 10px;
}

.col {
  flex: 1;
  min-width: 200px;
}

/* === FIELDSETS === */
fieldset {
  border: 2px solid var(--dorado);
  border-radius: 12px;
  padding: 18px;
  margin-top: 20px;
}

legend {
  color: var(--dorado);
  font-weight: 700;
  font-size: 1.1em;
  padding: 0 10px;
}

/* === TABLAS === */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  border-radius: 8px;
  overflow: hidden;
  background: var(--gris-tabla);
}

th, td {
  padding: 10px 8px;
  border-bottom: 1px solid #555;
  text-align: center;
  font-size: 0.95em;
  color: var(--blanco);
}

th {
  background: var(--rojo);
  font-weight: bold;
}

tr:nth-child(even) {
  background: #383850;
}

tr:hover {
  background: #4a4a6a;
}

/* === BOTONES === */
button.btn-primary {
  background: var(--dorado);
  color: var(--gris-fondo);
  border: none;
  padding: 10px 18px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
}

button.btn-primary:hover {
  background: #e6c200;
  transform: scale(1.05);
}

button.btn-danger {
  background: #e74c3c;
  color: var(--blanco);
  border: none;
  padding: 6px 14px;
  border-radius: 6px;
  cursor: pointer;
}

button.btn-danger:hover {
  background: #c0392b;
}

/* === ACCIONES === */
.actions {
  display: flex;
  justify-content: center;
  gap: 8px;
  flex-wrap: wrap;
}

/* === MODAL / PREVIEW === */
#recibo {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  overflow: auto;
  padding: 50px 0;
  z-index: 9999;
}

#contenidoRecibo {
  background: var(--gris-tabla);
  color: var(--blanco);
  margin: 0 auto;
  padding: 20px;
  width: 90%;
  max-width: 800px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
}

#contenidoRecibo h2 {
  margin-top: 0;
  color: var(--dorado);
}

/* === MODO IMPRESI√ìN === */
@media print {
  .no-print { display: none !important; }
  #recibo { position: static; transform: none; width: auto; height: auto; border: none; box-shadow: none; }
}
</style>
</head>
<body>

<div class="container">
<h2>Generar BEO - Orden de Evento</h2>

<form id="beoForm">

<!-- Datos generales -->
<fieldset>
<legend>Datos generales</legend>
<div class="row">
  <div class="col"><label>N¬∞ de Reserva</label><input id="numReserva" readonly></div>
  <div class="col"><label>Fecha registro</label><input id="fechaRegistro" type="date" required></div>
  <div class="col"><label>Fecha evento</label><input id="fechaEvento" type="date" required></div>
</div>
<div class="row">
  <div class="col"><label>Hora inicio</label><input id="horaInicio" type="time" required></div>
  <div class="col"><label>Hora fin</label><input id="horaFin" type="time" required></div>
  <div class="col"><label>Sal√≥n</label><input id="salon" required></div>
  <div class="col"><label>Tipo de evento</label><input id="tipoEvento" required></div>
</div>
</fieldset>

<!-- Datos cliente -->
<fieldset>
<legend>Datos del cliente y responsable</legend>
<div class="row">
  <div class="col"><label>Facturar a nombre de</label><input id="facturarA" required></div>
  <div class="col"><label>Tel√©fono</label><input id="telefono" required></div>
  <div class="col"><label>N¬∞ Personas</label><input id="numPersonas" type="number" min="1"></div>
</div>
<div class="row">
  <div class="col"><label>Nombre en cartera</label><input id="nombreCartera"></div>
  <div class="col"><label>C√≥digo</label><input id="codigo"></div>
  <div class="col"><label>Contacto comercial</label><input id="contactoComercial"></div>
</div>
<div class="row">
  <div class="col"><label>Contacto en el evento</label><input id="contactoEvento"></div>
  <div class="col"><label>Tel. contacto</label><input id="telContacto"></div>
  <div class="col"><label>Responsable de pago</label><input id="responsablePago"></div>
</div>
<div class="row">
  <div class="col"><label>DUI</label><input id="dui"></div>
  <div class="col"><label>NIT</label><input id="nit"></div>
  <div class="col"><label>No. IVA</label><input id="noIva"></div>
  <div class="col"><label>Ejecutiva de ventas</label><input id="ejecutivaVentas"></div>
</div>
<div class="row">
  <div class="col"><label>Tel. ejecutiva</label><input id="telEjecutiva"></div>
  <div class="col"><label>Cel. ejecutiva</label><input id="celEjecutiva"></div>
  <div class="col"></div>
</div>
</fieldset>

<!-- Montaje din√°mico -->
<fieldset>
<legend>Montaje (agregar m√∫ltiples)</legend>
<div style="display:flex;gap:8px;align-items:center">
  <input id="montajeTipo" placeholder="Descripci√≥n del montaje">
  <input id="montajeCantidad" type="number" min="1" placeholder="Cant." style="width:110px">
  <button type="button" onclick="agregarMontaje()">Agregar</button>
</div>
<table id="tablaMontaje" class="table-small">
  <thead><tr><th>Tipo</th><th>Cant.</th><th class="no-print">Acciones</th></tr></thead>
  <tbody></tbody>
</table>
</fieldset>

<!-- Cocina din√°mica -->
<fieldset>
<legend>Cocina</legend>
<div style="display:flex;gap:8px;align-items:center">
  <input id="cocinaTipo" placeholder="Descripci√≥n del √≠tem de cocina">
  <input id="cocinaCantidad" type="number" min="1" placeholder="Cant." style="width:110px">
  <button type="button" onclick="agregarCocina()">Agregar</button>
</div>
<table id="tablaCocina" class="table-small">
<thead><tr><th>Item</th><th>Cant.</th><th class="no-print">Acciones</th></tr></thead>
<tbody></tbody>
</table>
</fieldset>

<!-- Montos y productos -->
<fieldset>
<legend>Montos / Productos y Servicios</legend>
<div class="row">
  <div class="col"><label>Monto por reservaci√≥n ($)</label><input id="montoReserva" type="number" step="0.01" value="0"></div>
  <div class="col"><label>Pago adelantado ($)</label><input id="pagoAdelantado" type="number" step="0.01" value="0"></div>
  <div class="col"><label>Monto pendiente ($)</label><input id="montoPendiente" readonly></div>
</div>

<!-- Productos y Servicios -->
<fieldset>
  <legend>Productos y Servicios</legend>

  <label>Productos y Servicios</label>

  <!-- Fila de inputs alineada con la tabla -->
  <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
    <input id="prodCodigo" placeholder="C√≥digo" style="flex:1; padding:6px;">
    <input id="prodDesc" placeholder="Descripci√≥n" style="flex:2; padding:6px;">
    <input id="prodCant" type="number" placeholder="Cant." style="width:90px; padding:6px; text-align:center;">
    <input id="prodPrecio" type="number" placeholder="Precio" style="width:110px; padding:6px; text-align:right;">
    <input id="prodValor" type="text" placeholder="Valor" readonly style="width:110px; padding:6px; background:#3a3a5a; color:white; text-align:right;">
    <button type="button" onclick="agregarProducto()" style="padding:8px 12px;">‚ûï Agregar</button>
  </div>

  <table id="tablaProductos" class="table-small" style="width:100%; border-collapse:collapse;">
    <thead>
      <tr>
        <th>C√≥digo</th>
        <th>Descripci√≥n</th>
        <th>Cantidad</th>
        <th>Precio uni.</th>
        <th>Valor</th>
        <th class="no-print">Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</fieldset>


<!-- Mantenimiento -->
<fieldset>
  <legend>Mantenimiento</legend>
  <label>Observaciones / Detalles del mantenimiento</label>
  <textarea id="manObservaciones" rows="3" placeholder="Escribe aqu√≠ las observaciones o notas relacionadas con el mantenimiento..."></textarea>

  <table id="tablaMantenimiento" class="table-small" style="width:100%;border-collapse:collapse;">
    <thead>
      <tr>
        <th colspan="2">N. de ing. Caja</th>
        <th>Fecha</th>
        <th>Valor</th>
        <th class="no-print">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>D</td>
        <td contenteditable="true" style="border:1px solid #ccc; padding:4px; min-width:180px;"></td>
        <td><input type="date" style="width:150px; padding:4px;"></td>
        <td><input type="text" placeholder="$0.00" style="width:100px; padding:4px;"></td>
        <td class="no-print"><button type="button" class="btn-danger" onclick="this.closest('tr').remove()">Borrar</button></td>
      </tr>
      <tr>
        <td>1</td>
        <td contenteditable="true" style="border:1px solid #ccc; padding:4px; min-width:180px;"></td>
        <td><input type="date" style="width:150px; padding:4px;"></td>
        <td><input type="text" placeholder="$0.00" style="width:100px; padding:4px;"></td>
        <td class="no-print"><button type="button" class="btn-danger" onclick="this.closest('tr').remove()">Borrar</button></td>
      </tr>
      <tr>
        <td>2</td>
        <td contenteditable="true" style="border:1px solid #ccc; padding:4px; min-width:180px;"></td>
        <td><input type="date" style="width:150px; padding:4px;"></td>
        <td><input type="text" placeholder="$0.00" style="width:100px; padding:4px;"></td>
        <td class="no-print"><button type="button" class="btn-danger" onclick="this.closest('tr').remove()">Borrar</button></td>
      </tr>
    </tbody>
  </table>

  <div style="margin-top:10px;">
    <button type="button" onclick="agregarFila()">‚ûï Agregar fila</button>
  </div>
</fieldset>

<!-- Bot√≥n opcional reinicio de contador -->
<div style="text-align:center; margin:15px 0;" class="no-print">
  <button type="button" onclick="reiniciarContador()">üîÑ Reiniciar N¬∞ Reserva</button>
</div>

<div style="text-align:center; margin-top:15px;">
  <button type="submit" class="btn-primary">Guardar y Generar BEO</button>
</div>

</form>
</div>

<script>
// =======================
// CONTADOR BEO / N¬∞ RESERVA
// =======================

// Inicializa contador si no existe
if (!localStorage.getItem('contadorBEO')) {
  localStorage.setItem('contadorBEO', '1'); // comienza desde 1
}

// Funci√≥n para actualizar el campo N¬∞ de Reserva
function actualizarNumReserva() {
  const contadorActual = parseInt(localStorage.getItem('contadorBEO'), 10);
  document.getElementById('numReserva').value = String(contadorActual).padStart(4, '0');
}

// Mostrar el n√∫mero al cargar la p√°gina
actualizarNumReserva();

// Funci√≥n para incrementar el contador al guardar un BEO
function incrementarContadorBEO() {
  let contadorActual = parseInt(localStorage.getItem('contadorBEO'), 10);
  contadorActual++;
  localStorage.setItem('contadorBEO', contadorActual);
  actualizarNumReserva();
}

// Opcional: bot√≥n para reiniciar el contador manualmente
function reiniciarContador() {
  if (confirm("‚ö†Ô∏è ¬øDeseas reiniciar el N¬∞ de Reserva a 0001?")) {
    localStorage.setItem('contadorBEO', '1');
    actualizarNumReserva();
  }
}

// =======================
// FUNCIONES AUXILIARES
// =======================
const STORAGE_KEY = 'reservas';

function getReservas() { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
function setReservas(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

function formatTelefono(input) {
  input.addEventListener('input', () => {
    let v = input.value.replace(/\D/g, '');
    if (v.length > 4) v = v.slice(0,4) + '-' + v.slice(4,8);
    input.value = v;
  });
}

function formatDUI(input) {
  input.addEventListener('input', () => {
    let v = input.value.replace(/\D/g, '');
    if (v.length > 8) v = v.slice(0,8) + '-' + v.slice(8,9);
    input.value = v;
  });
}

['telefono','telContacto','telEjecutiva','celEjecutiva'].forEach(id => formatTelefono(document.getElementById(id)));
formatDUI(document.getElementById('dui'));

// Calcular pendiente
function calcularPendiente() {
  const monto = parseFloat(document.getElementById('montoReserva').value) || 0;
  const adelanto = parseFloat(document.getElementById('pagoAdelantado').value) || 0;
  const pendiente = Math.max(0, monto - adelanto);
  document.getElementById('montoPendiente').value = pendiente.toFixed(2);
}

document.getElementById('montoReserva').addEventListener('input', calcularPendiente);
document.getElementById('pagoAdelantado').addEventListener('input', calcularPendiente);
window.addEventListener('DOMContentLoaded', calcularPendiente);

// Funciones de tablas din√°micas (Montaje, Cocina, Productos, Mantenimiento)
function crearBotonEliminar(onclick) {
  const btn = document.createElement('button');
  btn.textContent = 'Eliminar';
  btn.type = 'button';
  btn.onclick = onclick;
  return btn;
}

function agregarMontaje() {
  const tipo = document.getElementById('montajeTipo').value;
  const cant = parseInt(document.getElementById('montajeCantidad').value)||0;
  if (!tipo || cant <= 0) { alert('Selecciona tipo y cantidad v√°lida'); return; }
  const tbody = document.querySelector('#tablaMontaje tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${tipo}</td><td>${cant}</td>`;
  const tdAcc = document.createElement('td'); tdAcc.appendChild(crearBotonEliminar(()=>tr.remove())); tr.appendChild(tdAcc);
  tbody.appendChild(tr);
  document.getElementById('montajeTipo').value = '';
  document.getElementById('montajeCantidad').value = '';
}

function agregarCocina() {
  const tipo = document.getElementById('cocinaTipo').value;
  const cant = parseInt(document.getElementById('cocinaCantidad').value)||0;
  if (!tipo || cant <= 0) { alert('Selecciona item y cantidad v√°lida'); return; }
  const tbody = document.querySelector('#tablaCocina tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${tipo}</td><td>${cant}</td>`;
  const tdAcc = document.createElement('td'); tdAcc.appendChild(crearBotonEliminar(()=>tr.remove())); tr.appendChild(tdAcc);
  tbody.appendChild(tr);
  document.getElementById('cocinaTipo').value = '';
  document.getElementById('cocinaCantidad').value = '';
}

function agregarProducto() {
  const cod = document.getElementById('prodCodigo').value.trim();
  const desc = document.getElementById('prodDesc').value.trim();
  const cant = parseFloat(document.getElementById('prodCant').value)||0;
  const precio = parseFloat(document.getElementById('prodPrecio').value)||0;
  if (!desc || cant <= 0 || precio <= 0) { alert('Llena correctamente el producto'); return; }
  const val = (cant * precio).toFixed(2);
  const tbody = document.querySelector('#tablaProductos tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${cod}</td><td>${desc}</td><td>${cant}</td><td>${precio.toFixed(2)}</td><td>${val}</td>`;
  const tdAcc = document.createElement('td'); tdAcc.appendChild(crearBotonEliminar(()=>tr.remove())); tr.appendChild(tdAcc);
  tbody.appendChild(tr);
  document.getElementById('prodCodigo').value = '';
  document.getElementById('prodDesc').value = '';
  document.getElementById('prodCant').value = '';
  document.getElementById('prodPrecio').value = '';
}

// =======================
// GUARDAR BEO
// =======================
document.getElementById('beoForm').addEventListener('submit', function(ev){
  ev.preventDefault();

  const camposObligatorios=['fechaRegistro','fechaEvento','horaInicio','horaFin','salon','tipoEvento','facturarA','telefono'];
  const faltantes=[];
  camposObligatorios.forEach(id => {
    if (!document.getElementById(id).value.trim()) faltantes.push(id);
  });
  if (faltantes.length>0) {
    const nombres=faltantes.map(id => document.querySelector(`label[for="${id}"]`)?.textContent||id).join(', ');
    const confirmar = confirm(`‚ö†Ô∏è No has completado los siguientes campos: ${nombres}\n\n¬øDeseas guardar de todos modos?`);
    if (!confirmar) { document.getElementById(faltantes[0]).focus(); return; }
  }

  const reserva = {
    id: String(parseInt(localStorage.getItem('contadorBEO'),10)).padStart(3,'0'),
    fechaRegistro: document.getElementById('fechaRegistro').value,
    fechaEvento: document.getElementById('fechaEvento').value,
    horaInicio: document.getElementById('horaInicio').value,
    horaFin: document.getElementById('horaFin').value,
    salon: document.getElementById('salon').value,
    tipoEvento: document.getElementById('tipoEvento').value,
    facturarA: document.getElementById('facturarA').value,
    telefono: document.getElementById('telefono').value,
    numPersonas: document.getElementById('numPersonas').value,
    nombreCartera: document.getElementById('nombreCartera').value,
    codigo: document.getElementById('codigo').value,
    contactoComercial: document.getElementById('contactoComercial').value,
    contactoEvento: document.getElementById('contactoEvento').value,
    telContacto: document.getElementById('telContacto').value,
    responsablePago: document.getElementById('responsablePago').value,
    dui: document.getElementById('dui').value,
    nit: document.getElementById('nit').value,
    noIva: document.getElementById('noIva').value,
    ejecutivaVentas: document.getElementById('ejecutivaVentas').value,
    telEjecutiva: document.getElementById('telEjecutiva').value,
    celEjecutiva: document.getElementById('celEjecutiva').value,
    montoReserva: parseFloat(document.getElementById('montoReserva').value)||0,
    pagoAdelantado: parseFloat(document.getElementById('pagoAdelantado').value)||0,
    montoPendiente: parseFloat(document.getElementById('montoPendiente').value)||0,
    montaje: Array.from(document.querySelectorAll('#tablaMontaje tbody tr')).map(tr => ({
      tipo: tr.children[0].textContent.trim(),
      cantidad: tr.children[1].textContent.trim()
    })),
    cocina: Array.from(document.querySelectorAll('#tablaCocina tbody tr')).map(tr => ({
      item: tr.children[0].textContent.trim(),
      cantidad: tr.children[1].textContent.trim()
    })),
    productos: Array.from(document.querySelectorAll('#tablaProductos tbody tr')).map(tr => ({
      codigo: tr.children[0].textContent.trim(),
      descripcion: tr.children[1].textContent.trim(),
      cantidad: tr.children[2].textContent.trim(),
      precio: tr.children[3].textContent.trim(),
      valor: tr.children[4].textContent.trim()
    })),
    manObservaciones: document.getElementById('manObservaciones').value || '',
    mantenimiento: Array.from(document.querySelectorAll('#tablaMantenimiento tbody tr')).map(tr => ({
      n: tr.children[0].textContent.trim(),
      dato: tr.children[1].textContent.trim(),
      fecha: tr.children[2].querySelector('input')?.value || '',
      valor: tr.children[3].querySelector('input')?.value || ''
    })),
    createdAt: new Date().toISOString()
  };

  const arr = getReservas();

  // === VERIFICAR SI YA EXISTE UNA RESERVA CON MISMA FECHA, HORA Y SAL√ìN ===
  const conflicto = arr.find(r =>
    r.fechaEvento === reserva.fechaEvento &&
    r.salon.toLowerCase() === reserva.salon.toLowerCase() &&
    (
      // Verifica si hay traslape de horarios
      (reserva.horaInicio >= r.horaInicio && reserva.horaInicio < r.horaFin) ||
      (reserva.horaFin > r.horaInicio && reserva.horaFin <= r.horaFin) ||
      (reserva.horaInicio <= r.horaInicio && reserva.horaFin >= r.horaFin)
    )
  );

  if (conflicto) {
    alert(`‚ö†Ô∏è El sal√≥n "${reserva.salon}" ya est√° reservado el ${reserva.fechaEvento} entre ${conflicto.horaInicio} y ${conflicto.horaFin}.\n\nPor favor selecciona otra fecha u horario.`);
    return; // ‚ùå Cancela el guardado
  }

  // === SI NO HAY CONFLICTO, GUARDA NORMAL ===
  arr.push(reserva);
  setReservas(arr);
  localStorage.setItem("datosBEO", JSON.stringify(reserva));

  // Incrementar contador
  incrementarContadorBEO();

  alert('‚úÖ BEO guardado correctamente.');
  window.location.href = 'formulario.html';
});

</script>
</body>
</html>





